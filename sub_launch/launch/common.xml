<launch>

  <node pkg="nodelet" type="nodelet" name="imu" args="standalone adis16400_imu/nodelet">
    <param name="port" type="string" value="/tmp/imu"/>
    <param name="frame_id" type="string" value="/imu"/>
  </node>
  <node pkg="nodelet" type="nodelet" name="magnetic_dynamic_compensation" args="standalone magnetic_dynamic_compensation/nodelet">
    <remap from="/imu/mag" to="/imu/mag_lessraw"/>
  </node>
  <node pkg="nodelet" type="nodelet" name="magnetic_hardsoft_compensation" args="standalone magnetic_hardsoft_compensation/nodelet">
    <remap from="/imu/mag_raw" to="/imu/mag_lessraw"/>
    <param name="frame_id" type="string" value="/imu"/>
    <rosparam>
correction: [0.16518505729708194, 0.41635135769064785, -0.5003725952555389, 0.7409404225119256]
scale: [0.9824591199601406, 0.991700915163004, 1.0263720042299143]
shift: [1.972505436535728e-05, -2.630949101201508e-06, 6.149054775740445e-05]
    </rosparam>
  </node>

  <node pkg="nodelet" type="nodelet" name="depth" args="standalone depth_driver/nodelet">
    <param name="port" type="string" value="/tmp/depth"/>
    <param name="frame_id" type="string" value="/map"/>
  </node>

  <node pkg="nodelet" type="nodelet" name="dvl" args="standalone rdi_explorer_dvl/nodelet">
    <param name="port" type="string" value="/tmp/dvl"/>
    <param name="frame_id" type="string" value="/dvl"/>
  </node>

  <node pkg="tf" type="static_transform_publisher" name="dvl_broadcaster"
    args="0.43115992 0 -0.00165058  0.000000 0.000000 0.382683 -0.923880  base_link dvl 100" />
  <node pkg="tf" type="static_transform_publisher" name="imu_broadcaster"
    args="0.43115992 0 -0.00165058  0.012621 -0.999908 -0.004523 -0.002181  base_link imu 100" />

  <node pkg="legacy_ukf" type="legacy_ukf" name="legacy_ukf"><rosparam>
    fixed_frame: /map
    localMagneticVector: [-2244.2, 24151.0, -40572.8]
    latitudeDeg: 29.651388889
    vel_sigma: [0.02, 0.02, 0.02]
    att_sigma: [0.5, 0.5, 0.5]
    </rosparam>
    <remap from="bodyvel" to="dvl"/>
    <remap from="odom" to="imu_odom"/>
  </node>
  <node pkg="nodelet" type="nodelet" name="transform_odometry" args="standalone odometry_utils/transform_odometry"><rosparam>
    frame_id: /map
    child_frame_id: /base_link
  </rosparam>
    <remap from="orig_odom" to="imu_odom"/>
  </node>
  <node pkg="odometry_utils" type="odometry_to_tf" name="odometry_to_tf"/>

  <node pkg="c3_trajectory_generator" type="c3_trajectory_generator" name="c3_trajectory_generator"><rosparam>
    fixed_frame: /map
    body_frame: /base_link
  </rosparam></node>

  <node pkg="rise_6dof" type="rise_6dof" name="rise_6dof">
    <remap from="/current" to="odom"/>
    <remap from="/desired" to="trajectory"/>
    <remap from="/output" to="wrench"/>
    <rosparam file="$(find sub_launch)/launch/rise_6dof.yaml"/>
  </node>
  <node pkg="sub_launch" type="param_saver" name="rise_6dof_saver">
    <param name="filename" value="$(find sub_launch)/launch/rise_6dof.yaml"/>
    <rosparam>
      file_basepath: /rise_6dof
      param_paths: [k, ks, alpha, beta, use_rise]
    </rosparam>
  </node>

  <node pkg="thruster_mapper" type="thruster_mapper" name="thruster_mapper"/>

  <node pkg="sub_launch" type="odom_to_euler" name="odom_to_euler"/>

  <node pkg="rosbag" type="record" name="swim_recorder" args="-a -x '.*camera.*' -o /tmp/swim" respawn="true"/>

</launch>
